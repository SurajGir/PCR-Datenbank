<div class="d-flex justify-content-between mb-3">
    <h5>Manage PCR Kits</h5>
    <button type="button" class="btn btn-sm btn-primary" data-bs-toggle="modal" data-bs-target="#addPCRKitModal">
        <i class="bi bi-plus-circle me-1"></i> Add PCR Kit
    </button>
</div>

<ul class="nav nav-tabs mb-3" id="pcrKitsTabs" role="tablist">
    <li class="nav-item" role="presentation">
        <button class="nav-link active" id="all-tab" data-bs-toggle="tab" data-bs-target="#all-kits" type="button" role="tab" aria-controls="all-kits" aria-selected="true">All Kits</button>
    </li>
    <li class="nav-item" role="presentation">
        <button class="nav-link" id="mikrogen-tab" data-bs-toggle="tab" data-bs-target="#mikrogen-kits" type="button" role="tab" aria-controls="mikrogen-kits" aria-selected="false">Mikrogen</button>
    </li>
    <li class="nav-item" role="presentation">
        <button class="nav-link" id="external-tab" data-bs-toggle="tab" data-bs-target="#external-kits" type="button" role="tab" aria-controls="external-kits" aria-selected="false">External</button>
    </li>
</ul>

<div class="tab-content" id="pcrKitsTabContent">
    <div class="tab-pane fade show active" id="all-kits" role="tabpanel" aria-labelledby="all-tab">
        <div class="table-responsive">
            <table class="table table-striped table-hover">
                <thead>
                    <tr>
                        <th>Name</th>
                        <th>Type</th>
                        <th width="150">Actions</th>
                    </tr>
                </thead>
                <tbody>
                    {% for kit in pcr_kits %}
                        <tr>
                            <td>{{ kit.name }}</td>
                            <td>{{ kit.get_type_display }}</td>
                            <td>
                                <button type="button" class="btn btn-sm btn-outline-primary edit-kit-btn"
                                        data-bs-toggle="modal" data-bs-target="#editPCRKitModal"
                                        data-id="{{ kit.id }}" data-name="{{ kit.name }}" data-type="{{ kit.type }}">
                                    <i class="bi bi-pencil"></i>
                                </button>
                                <button type="button" class="btn btn-sm btn-outline-danger delete-kit-btn"
                                        data-bs-toggle="modal" data-bs-target="#deletePCRKitModal"
                                        data-id="{{ kit.id }}" data-name="{{ kit.name }}">
                                    <i class="bi bi-trash"></i>
                                </button>
                            </td>
                        </tr>
                    {% empty %}
                        <tr>
                            <td colspan="3" class="text-center py-4">
                                <p class="text-muted mb-0">No PCR kits defined yet</p>
                            </td>
                        </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>

    <div class="tab-pane fade" id="mikrogen-kits" role="tabpanel" aria-labelledby="mikrogen-tab">
        <div class="table-responsive">
            <table class="table table-striped table-hover">
                <thead>
                    <tr>
                        <th>Name</th>
                        <th width="150">Actions</th>
                    </tr>
                </thead>
                <tbody>
                    {% for kit in mikrogen_kits %}
                        <tr>
                            <td>{{ kit.name }}</td>
                            <td>
                                <button type="button" class="btn btn-sm btn-outline-primary edit-kit-btn"
                                        data-bs-toggle="modal" data-bs-target="#editPCRKitModal"
                                        data-id="{{ kit.id }}" data-name="{{ kit.name }}" data-type="{{ kit.type }}">
                                    <i class="bi bi-pencil"></i>
                                </button>
                                <button type="button" class="btn btn-sm btn-outline-danger delete-kit-btn"
                                        data-bs-toggle="modal" data-bs-target="#deletePCRKitModal"
                                        data-id="{{ kit.id }}" data-name="{{ kit.name }}">
                                    <i class="bi bi-trash"></i>
                                </button>
                            </td>
                        </tr>
                    {% empty %}
                        <tr>
                            <td colspan="2" class="text-center py-4">
                                <p class="text-muted mb-0">No Mikrogen PCR kits defined yet</p>
                            </td>
                        </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>

    <div class="tab-pane fade" id="external-kits" role="tabpanel" aria-labelledby="external-tab">
        <div class="table-responsive">
            <table class="table table-striped table-hover">
                <thead>
                    <tr>
                        <th>Name</th>
                        <th width="150">Actions</th>
                    </tr>
                </thead>
                <tbody>
                    {% for kit in external_kits %}
                        <tr>
                            <td>{{ kit.name }}</td>
                            <td>
                                <button type="button" class="btn btn-sm btn-outline-primary edit-kit-btn"
                                        data-bs-toggle="modal" data-bs-target="#editPCRKitModal"
                                        data-id="{{ kit.id }}" data-name="{{ kit.name }}" data-type="{{ kit.type }}">
                                    <i class="bi bi-pencil"></i>
                                </button>
                                <button type="button" class="btn btn-sm btn-outline-danger delete-kit-btn"
                                        data-bs-toggle="modal" data-bs-target="#deletePCRKitModal"
                                        data-id="{{ kit.id }}" data-name="{{ kit.name }}">
                                    <i class="bi bi-trash"></i>
                                </button>
                            </td>
                        </tr>
                    {% empty %}
                        <tr>
                            <td colspan="2" class="text-center py-4">
                                <p class="text-muted mb-0">No External PCR kits defined yet</p>
                            </td>
                        </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>

<!-- Add PCR Kit Modal -->
<div class="modal fade" id="addPCRKitModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Add New PCR Kit</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <form method="POST">
                {% csrf_token %}
                <input type="hidden" name="action" value="add">
                <input type="hidden" name="option_type" value="pcr_kit">
                <div class="modal-body">
                    <div class="mb-3">
                        <label for="pcr-kit-name" class="form-label">PCR Kit Name</label>
                        <input type="text" class="form-control" id="pcr-kit-name" name="name" required>
                    </div>
                    <div class="mb-3">
                        <label for="pcr-kit-type" class="form-label">PCR Kit Type</label>
                        <select class="form-select" id="pcr-kit-type" name="kit_type" required>
                            <option value="mikrogen">Mikrogen</option>
                            <option value="external">External</option>
                        </select>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="submit" class="btn btn-primary">Save</button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- Edit PCR Kit Modal -->
<div class="modal fade" id="editPCRKitModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Edit PCR Kit</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <form method="POST">
                {% csrf_token %}
                <input type="hidden" name="action" value="edit">
                <input type="hidden" name="option_type" value="pcr_kit">
                <input type="hidden" name="option_id" id="edit-pcr-kit-id">
                <div class="modal-body">
                    <div class="mb-3">
                        <label for="edit-pcr-kit-name" class="form-label">PCR Kit Name</label>
                        <input type="text" class="form-control" id="edit-pcr-kit-name" name="name" required>
                    </div>
                    <div class="mb-3">
                        <label for="edit-pcr-kit-type" class="form-label">PCR Kit Type</label>
                        <select class="form-select" id="edit-pcr-kit-type" name="kit_type" required>
                            <option value="mikrogen">Mikrogen</option>
                            <option value="external">External</option>
                        </select>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="submit" class="btn btn-primary">Save Changes</button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- Delete PCR Kit Modal -->
<div class="modal fade" id="deletePCRKitModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Delete PCR Kit</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <form method="POST">
                {% csrf_token %}
                <input type="hidden" name="action" value="delete">
                <input type="hidden" name="option_type" value="pcr_kit">
                <input type="hidden" name="option_id" id="delete-pcr-kit-id">
                <div class="modal-body">
                    <p>Are you sure you want to delete the PCR Kit "<span id="delete-pcr-kit-name"></span>"?</p>
                    <p class="text-danger">This action cannot be undone and may fail if this PCR Kit is used by any samples.</p>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="submit" class="btn btn-danger">Delete</button>
                </div>
            </form>
        </div>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // Handle edit button clicks
    document.querySelectorAll('.edit-kit-btn').forEach(button => {
        button.addEventListener('click', function() {
            const id = this.getAttribute('data-id');
            const name = this.getAttribute('data-name');
            const type = this.getAttribute('data-type');

            document.getElementById('edit-pcr-kit-id').value = id;
            document.getElementById('edit-pcr-kit-name').value = name;
            document.getElementById('edit-pcr-kit-type').value = type;
        });
    });

    // Handle delete button clicks
    document.querySelectorAll('.delete-kit-btn').forEach(button => {
        button.addEventListener('click', function() {
            const id = this.getAttribute('data-id');
            const name = this.getAttribute('data-name');

            document.getElementById('delete-pcr-kit-id').value = id;
            document.getElementById('delete-pcr-kit-name').textContent = name;
        });
    });
});
</script>